from langchain.docstore.document import Document
import pandas as pd
from typing import List
from numpy import nan
import ast 

ENCODING = 'utf-8-sig'

def load_docs(docs_path, eval_strings=False) -> List[Document]:
    """
    Load documents from the website extracts csv generated by the 
    data processing pipeline 
    - docs_path: filepath to the document csv to load
    - eval_strings: if true, evaluates fields from strings to lists/dicts
    """
    docs_df = pd.read_csv(docs_path,index_col=0,encoding=ENCODING)
    docs_df[['faculty','program','specialization']] = docs_df[['faculty','program','specialization']].replace(nan, 'None')
    docs_df = docs_df.replace(nan, '')
    
    docs = []
    for (idx,row) in docs_df.iterrows():
        doc = None
        if eval_strings:
            doc = Document(page_content=row['text'],
                           metadata={
                              **row,
                              'titles': ast.literal_eval(row['titles']),
                              'parent_titles': ast.literal_eval(row['parent_titles']),
                              'links': ast.literal_eval(row['links'])})
        else:
            doc = Document(page_content=row['text'], metadata={**row})
        docs.append(doc)

    return docs